<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaderboard - QuizMaster</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
      /* Leaderboard Styles */
.leaderboard-section {
    background: white;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 15px 50px rgba(0,0,0,0.1);
}

.leaderboard-section h2 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 2rem;
    font-size: 2.2rem;
}

.leaderboard-info {
    text-align: center;
    margin-bottom: 2rem;
}

.category-info {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    padding: 1rem 2rem;
    border-radius: 25px;
    font-size: 1.1rem;
    font-weight: 600;
    display: inline-block;
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
}

.leaderboard-filters {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 12px;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.leaderboard-filters label {
    font-weight: 600;
    color: #2c3e50;
    white-space: nowrap;
}

.leaderboard-table {
    overflow-x: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.leaderboard-table table {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.leaderboard-table th {
    background: linear-gradient(135deg, #34495e, #2c3e50);
    color: white;
    padding: 1.2rem 1rem;
    text-align: left;
    font-weight: 600;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.leaderboard-table td {
    padding: 1.2rem 1rem;
    border-bottom: 1px solid #e9ecef;
    color: #2c3e50;
}

.leaderboard-table tr:hover {
    background: #f8f9fa;
}

.leaderboard-table tr:last-child td {
    border-bottom: none;
}

/* Rank Badges */
.rank-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: #f8f9fa;
    font-weight: bold;
    color: #6c757d;
}

.rank-1 {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: white;
    box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
}
.rank-2 {
    background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
    color: white;
    box-shadow: 0 2px 8px rgba(192, 192, 192, 0.3);
}

.rank-3 {
    background: linear-gradient(135deg, #CD7F32, #A56A2B);
    color: white;
    box-shadow: 0 2px 8px rgba(205, 127, 50, 0.3);
}

.player-name {
    font-weight: 600;
    color: #2c3e50;
}

.score {
    color: #27ae60;
    font-weight: bold;
    font-size: 1.1rem;
}

.category {
    color: #3498db;
    font-weight: 500;
}

.date {
    color: #7f8c8d;
    font-size: 0.9rem;
}
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="header-content">
                <div class="logo">
                    <h1>üß† QuizMaster</h1>
                </div>
                <div class="user-info">
                    <a href="home.html" class="btn btn-secondary">‚Üê Back to Home</a>
                </div>
            </div>
        </header>

        <main class="dashboard-main">
            <div class="leaderboard-section">
                <h2>üèÜ Leaderboard</h2>

                <div class="leaderboard-info">
                    <p id="leaderboardCategory" class="category-info"></p>
                </div>

                <div class="leaderboard-filters hidden" id="categoryFilterSection">
                    <label for="categoryFilter">Filter by Category:</label>
                    <select id="categoryFilter" class="form-control">
                        <option value="">All Categories</option>
                    </select>
                </div>

                <div class="leaderboard-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>Score</th>
                                <th>Time Taken</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboardBody">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading leaderboard...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script src="js/utils.js"></script>
    <script>
        let currentCategoryId = null;
        let allCategories = [];

        document.addEventListener('DOMContentLoaded', async function() {
            // Get category from URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            currentCategoryId = urlParams.get('category');

            await loadCategories();
            loadLeaderboard();

            // Only show filter if no specific category is selected
            if (!currentCategoryId) {
                document.getElementById('categoryFilterSection').classList.remove('hidden');
                document.getElementById('categoryFilter').addEventListener('change', loadLeaderboard);
            }
        });

        async function loadCategories() {
            try {
                allCategories = await fetchCategories();
                const categoryFilter = document.getElementById('categoryFilter');
                const categoryInfo = document.getElementById('leaderboardCategory');

                // Populate category filter
                allCategories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    categoryFilter.appendChild(option);
                });

                // Show current category info
                if (currentCategoryId) {
                    const category = allCategories.find(cat => cat.id == currentCategoryId);
                    if (category) {
                        categoryInfo.textContent = `Category: ${category.name}`;
                        categoryInfo.classList.remove('hidden');
                    }
                }

            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

       async function loadLeaderboard() {
    try {
        const categoryId = currentCategoryId || document.getElementById('categoryFilter').value;
        const leaderboard = await fetchLeaderboard(categoryId);

        const tbody = document.getElementById('leaderboardBody');

        if (leaderboard.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" style="text-align: center; padding: 2rem;">
                        No leaderboard data available for this category
                    </td>
                </tr>`;
            return;
        }

        tbody.innerHTML = leaderboard.map((entry, index) => `
            <tr>
                <td>
                    <span class="rank-badge ${index < 3 ? `rank-${index + 1}` : ''}">
                        ${index + 1}
                    </span>
                </td>
                <td class="player-name">${entry.username}</td>
                <td><strong class="score">${entry.score}</strong></td>
                <td class="time">${entry.time_taken ? formatTime(entry.time_taken) : 'N/A'}</td>
                <td class="date">${new Date(entry.completed_at).toLocaleDateString()}</td>
            </tr>
        `).join('');

    } catch (error) {
        console.error('Error loading leaderboard:', error);
        document.getElementById('leaderboardBody').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem; color: #e74c3c;">
                    Error loading leaderboard data. Please try again later.
                </td>
            </tr>`;
    }
}

// Helper to convert seconds into mm:ss format
function formatTime(seconds) {
    if (isNaN(seconds)) return 'N/A';
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}:${secs.toString().padStart(2, '0')}`;
}

    </script>
</body>
</html>